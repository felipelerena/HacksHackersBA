<!doctype html>
<html>
  <head>

    <script src="javascript/popcorn.js"></script>
    <script src="javascript/jquery-1.6.1.min.js"></script>

    <script>
    var pop = null;
    var restauracion = '';
    var elements = Array();
	
    function parseSlide(){
        elem = $(this);
        switch(elem.attr("data-type")){
            case "slide":
                callback = change_text;
                break;
        }
	    props = {start: elem.attr("data-from"), 
                 end: elem.attr("data-to"),
                 html: elem.html(),
                 callback: callback,
                 title: elem.children('h2').html()};
        elements.push(props);
    }    

    function generateElements(){
        var slides = $('#slides article').each(parseSlide);
    }

    function showMaestro(maestro_id){
	    var maestros = Array('./carlos.webm');
	    var video_url = maestros[maestro_id];
            var video = '<h2>maestro:</h2><video id="video_maestro_' + maestro_id +'" controls style="float:left" autoplay="true"><source src=" ' + video_url + '"></source></video><br><a href="#" onClick="restaurar()">cerrar</a>';
	    restauracion = $('#right').html();
	    pop.pause()
	    $('#right').html(video);
	
    }
    
    function restaurar(){
	$('#right').html(restauracion);
	pop.play()
    }

    function gotoAndPlay(start){
	pop.currentTime([start]);
    }

    function add_thumb(pop, title, start) {
	var thumbs = $('#thumbs');
	var id_ = 'video_' + Math.ceil(Math.random() * 100000);
	thumbs.append('<li><a href="#" onclick="gotoAndPlay(' + start + ')">' + title + '</a></span></li>');
    }

    function loadElement(pop, data){
        add_thumb(pop, data.title, data.start);
    }

    function change_text(video, options) {
       	$('#right').html(options.html);
    }

    function clear_text(video, options) {
       	$('#right').html("");
    }

    function populate(pop, elements, onload) {
	for(element in elements) {
	    data = elements[element];
	    pop.interventor(data);
	    onload(pop, data);
	}
    }

    function populate_shortener(pop, elements) {
	for(i=0; i<elements.length; i++) { 
	    data = elements[i];
	    next_element = elements[i + 1];
	    if(next_element){
	    	data.next_start = next_element.start;
	    }
	    pop.shortener(data);
	}
    }

    (function(Popcorn) {
	  Popcorn.plugin( "interventor" , function( options ) {
	    return {
	      start: function( event, options ) {
		    if(options.callback) {
		        options.callback(this, options);
		    } 
	      },
	      end: function( event, options ) {
		if (options.endcallback) {
		    options.endcallback(this, options);
                } else {
		    clear_text(this, options)
		}
	      }
	    };
	  });
	  Popcorn.plugin( "shortener" , function( options ) {
	    return {
	      start: function( event, options ) {
		  var version_larga = $('#version_larga');
		  if(!version_larga.prop("checked")){
	          	gotoAndPlay(options.start);
                  }
	      },
	      end: function( event, options ) {
		  var version_larga = $('#version_larga');
                  if(!version_larga.prop("checked")){
		      if(options.next_start) {
	                  gotoAndPlay(options.next_start);
		      } else {
		          this.pause();
		      }
                  }
	      }
	    };
	  });
	    
	})(Popcorn);

    // ensure the DOM has loaded
    document.addEventListener("DOMContentLoaded", function () {

      // Create a popcporn instance by calling Popcorn("#id-of-my-video")
      pop = Popcorn("#video");    
      generateElements();
      console.log(elements);
      populate(pop, elements, loadElement);
      populate_shortener(pop, chunks);
    }, false);
    /*
    elements = [
	{
	    start: 0,
	    end: 5,
	    callback: change_text,
	    title: "una historia",
	    html: "una historia en <strong>HT&Ntilde;L5</strong>"
	},
	{
	    start: 10,
	    end: 12,
	    callback: change_text,
	    title: "amigos",
	    html: "amigos"
	},
	{
	    start: 25,
	    end: 1000,
	    callback: change_text,
	    title: "personalizar",
	    html: '<iframe src="http://www.elpais.es" style="width:650px;height:350px"></iframe><br><a href="#" onClick="showMaestro(0)">Ver video de maestro</a>'
	}
    ]*/

    chunks = [
	{
	    start: 0,
	    end: 5
	},
	{
	    start: 10,
	    end: 15
	}
    ]


    </script>
  </head>
  <body>

    <video id="video" controls style="float:left;height:380px">
      <source src="./carlos.webm"></source>
    </video>

    <div id="right" style="float:left;height:380px;width:600px"> </div>
    <div style="clear:both"></div>
    <div id="controls">
        <label for="version_larga">Version larga</label>
	<input type="checkbox" id="version_larga">
    </div>
    <div id="thumbs"></div>
    

    <div id="slides" style="display:none">
	    <article data-from="1" data-to="15" data-type="slide">
	        <h2>&iquest;Hacia d&oacute;nde estamos yendo?</h2>
            <ul>
	            <li>Auge de la conexi&oacute;n m&oacute;vil y el video</li>
	            <li>Papel fundamental de la indexaci&oacute;n para captar tr&aacute;fico de buscadores y redes sociales</li>
	            <li>Aparici&oacute;n de tecnolog&iacute;as que pueden cambiar paradigmas, hacia la trasmisi&oacute;n en vivo</li>
	            <li>Acercamiento de la TV y la web</li>
	            <li>La lucha por el contacto directo con el usuario</li>
            </ul>
            <p>
	            <strong>Bio:</strong> Carlos Serrano es Comunicador Social y Periodista de la Universidad Pontificia Bolivariana de Medell&iacute;n. Actualmente es el Editor de Medios Interactivos de la Fundaci&oacute;n Nuevo Periodismo Iberoamericano.
            </p>
            <p>
	            <h3>Enlaces</h3>
	            <ul>
	                <li><a href="http://www.nuevoperiodismo.org/">FNPI</a></li>
	                <li><a href="http://www.fnpi.org/nodo-digital/">NODO DIGITAL</a></li>
                    <li><a href="http://twitter.com/#!/carliserrano">TWITTER</a></li>
	            </ul>
            </p>
        </article>
    </div>

  </body>
</html>


